# Railway: use the Dockerfile instead of nixpacks to get ffmpeg + libGL reliably.
# In the Railway dashboard set: Settings → Build → Builder → Dockerfile
# and point it at ./Dockerfile.
#
# The config below is kept as a fallback only. The fragile mesa path grep
# has been replaced with a proper apt install in the Dockerfile.

[phases.setup]
nixPkgs = ["python310", "gcc", "cmake", "glib", "libgcc", "mesa", "libglvnd", "ffmpeg"]

[phases.install]
cmds = [
  "python3 -m venv /opt/venv",
  "/opt/venv/bin/pip install --upgrade pip",
  "/opt/venv/bin/pip install -r requirements.txt"
]

[start]
cmd = "/opt/venv/bin/gunicorn --bind 0.0.0.0:$PORT --timeout 600 --workers 1 --threads 4 --worker-class gthread backend.app:app"
